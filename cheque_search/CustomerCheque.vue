<template>
  <div class="customer-cheque">
    <div class="buttons">
      <div class="save">
        <busy-overlay :enabled="saving" />
        <button @click="print()">
          <v-icon name="download" />
        </button>
      </div>
    </div>
    <div
      class="cheque"
    >
      <busy-overlay :enabled="cheque != null && cheque.id != $route.params.cheque_id" />
      <svg
        viewBox="0 0 375 20"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
      >
        <g
          id="check_edge"
          stroke="none"
          stroke-width="1"
          fill="none"
          fill-rule="evenodd"
        >
          <path d="M374,19 L374,16.6365363 C374,13.3125617 372.973186,10.0650071 371.052422,7.31658437 L368.332784,3.42505364 C368.263691,3.32618858 368.175587,3.24023255 368.072824,3.17187572 C367.610965,2.86465084 366.977095,2.98164781 366.667216,3.42505364 L362.472125,9.42781106 C362.259511,9.73204124 361.990931,9.994071 361.680523,10.2005518 C360.317132,11.1074682 358.462485,10.7651457 357.527875,9.42781106 L353.332784,3.42505364 C353.263691,3.32618858 353.175587,3.24023255 353.072824,3.17187572 C352.610965,2.86465084 351.977095,2.98164781 351.667216,3.42505364 L347.472125,9.42781106 C347.259511,9.73204124 346.990931,9.994071 346.680523,10.2005518 C345.317132,11.1074682 343.462485,10.7651457 342.527875,9.42781106 L338.332784,3.42505364 C338.263691,3.32618858 338.175587,3.24023255 338.072824,3.17187572 C337.610965,2.86465084 336.977095,2.98164781 336.667216,3.42505364 L332.472125,9.42781106 C332.259511,9.73204124 331.990931,9.994071 331.680523,10.2005518 C330.317132,11.1074682 328.462485,10.7651457 327.527875,9.42781106 L323.332784,3.42505364 C323.263691,3.32618858 323.175587,3.24023255 323.072824,3.17187572 C322.610965,2.86465084 321.977095,2.98164781 321.667216,3.42505364 L317.472125,9.42781106 C317.259511,9.73204124 316.990931,9.994071 316.680523,10.2005518 C315.317132,11.1074682 313.462485,10.7651457 312.527875,9.42781106 L308.332784,3.42505364 C308.263691,3.32618858 308.175587,3.24023255 308.072824,3.17187572 C307.610965,2.86465084 306.977095,2.98164781 306.667216,3.42505364 L302.472125,9.42781106 C302.259511,9.73204124 301.990931,9.994071 301.680523,10.2005518 C300.317132,11.1074682 298.462485,10.7651457 297.527875,9.42781106 L293.332784,3.42505364 C293.263691,3.32618858 293.175587,3.24023255 293.072824,3.17187572 C292.610965,2.86465084 291.977095,2.98164781 291.667216,3.42505364 L287.472125,9.42781106 C287.259511,9.73204124 286.990931,9.994071 286.680523,10.2005518 C285.317132,11.1074682 283.462485,10.7651457 282.527875,9.42781106 L278.332784,3.42505364 C278.263691,3.32618858 278.175587,3.24023255 278.072824,3.17187572 C277.610965,2.86465084 276.977095,2.98164781 276.667216,3.42505364 L272.472125,9.42781106 C272.259511,9.73204124 271.990931,9.994071 271.680523,10.2005518 C270.317132,11.1074682 268.462485,10.7651457 267.527875,9.42781106 L263.332784,3.42505364 C263.263691,3.32618858 263.175587,3.24023255 263.072824,3.17187572 C262.610965,2.86465084 261.977095,2.98164781 261.667216,3.42505364 L257.472125,9.42781106 C257.259511,9.73204124 256.990931,9.994071 256.680523,10.2005518 C255.317132,11.1074682 253.462485,10.7651457 252.527875,9.42781106 L248.332784,3.42505364 C248.263691,3.32618858 248.175587,3.24023255 248.072824,3.17187572 C247.610965,2.86465084 246.977095,2.98164781 246.667216,3.42505364 L242.472125,9.42781106 C242.259511,9.73204124 241.990931,9.994071 241.680523,10.2005518 C240.317132,11.1074682 238.462485,10.7651457 237.527875,9.42781106 L233.332784,3.42505364 C233.263691,3.32618858 233.175587,3.24023255 233.072824,3.17187572 C232.610965,2.86465084 231.977095,2.98164781 231.667216,3.42505364 L227.472125,9.42781106 C227.259511,9.73204124 226.990931,9.994071 226.680523,10.2005518 C225.317132,11.1074682 223.462485,10.7651457 222.527875,9.42781106 L218.332784,3.42505364 C218.263691,3.32618858 218.175587,3.24023255 218.072824,3.17187572 C217.610965,2.86465084 216.977095,2.98164781 216.667216,3.42505364 L212.472125,9.42781106 C212.259511,9.73204124 211.990931,9.994071 211.680523,10.2005518 C210.317132,11.1074682 208.462485,10.7651457 207.527875,9.42781106 L203.332784,3.42505364 C203.263691,3.32618858 203.175587,3.24023255 203.072824,3.17187572 C202.610965,2.86465084 201.977095,2.98164781 201.667216,3.42505364 L197.472125,9.42781106 C197.259511,9.73204124 196.990931,9.994071 196.680523,10.2005518 C195.317132,11.1074682 193.462485,10.7651457 192.527875,9.42781106 L188.332784,3.42505364 C188.263691,3.32618858 188.175587,3.24023255 188.072824,3.17187572 C187.610965,2.86465084 186.977095,2.98164781 186.667216,3.42505364 L182.472125,9.42781106 C182.259511,9.73204124 181.990931,9.994071 181.680523,10.2005518 C180.317132,11.1074682 178.462485,10.7651457 177.527875,9.42781106 L173.332784,3.42505364 C173.263691,3.32618858 173.175587,3.24023255 173.072824,3.17187572 C172.610965,2.86465084 171.977095,2.98164781 171.667216,3.42505364 L167.472125,9.42781106 C167.259511,9.73204124 166.990931,9.994071 166.680523,10.2005518 C165.317132,11.1074682 163.462485,10.7651457 162.527875,9.42781106 L158.332784,3.42505364 C158.263691,3.32618858 158.175587,3.24023255 158.072824,3.17187572 C157.610965,2.86465084 156.977095,2.98164781 156.667216,3.42505364 L152.472125,9.42781106 C152.259511,9.73204124 151.990931,9.994071 151.680523,10.2005518 C150.317132,11.1074682 148.462485,10.7651457 147.527875,9.42781106 L143.332784,3.42505364 C143.263691,3.32618858 143.175587,3.24023255 143.072824,3.17187572 C142.610965,2.86465084 141.977095,2.98164781 141.667216,3.42505364 L137.472125,9.42781106 C137.259511,9.73204124 136.990931,9.994071 136.680523,10.2005518 C135.317132,11.1074682 133.462485,10.7651457 132.527875,9.42781106 L128.332784,3.42505364 C128.263691,3.32618858 128.175587,3.24023255 128.072824,3.17187572 C127.610965,2.86465084 126.977095,2.98164781 126.667216,3.42505364 L122.472125,9.42781106 C122.259511,9.73204124 121.990931,9.994071 121.680523,10.2005518 C120.317132,11.1074682 118.462485,10.7651457 117.527875,9.42781106 L113.332784,3.42505364 C113.263691,3.32618858 113.175587,3.24023255 113.072824,3.17187572 C112.610965,2.86465084 111.977095,2.98164781 111.667216,3.42505364 L107.472125,9.42781106 C107.259511,9.73204124 106.990931,9.994071 106.680523,10.2005518 C105.317132,11.1074682 103.462485,10.7651457 102.527875,9.42781106 L98.3327842,3.42505364 C98.2636914,3.32618858 98.1755868,3.24023255 98.0728241,3.17187572 C97.6109648,2.86465084 96.9770946,2.98164781 96.6672158,3.42505364 L92.4721251,9.42781106 C92.2595106,9.73204124 91.9909313,9.994071 91.6805232,10.2005518 C90.3171315,11.1074682 88.4624854,10.7651457 87.5278749,9.42781106 L83.3327842,3.42505364 C83.2636914,3.32618858 83.1755868,3.24023255 83.0728241,3.17187572 C82.6109648,2.86465084 81.9770946,2.98164781 81.6672158,3.42505364 L77.4721251,9.42781106 C77.2595106,9.73204124 76.9909313,9.994071 76.6805232,10.2005518 C75.3171315,11.1074682 73.4624854,10.7651457 72.5278749,9.42781106 L68.3327842,3.42505364 C68.2636914,3.32618858 68.1755868,3.24023255 68.0728241,3.17187572 C67.6109648,2.86465084 66.9770946,2.98164781 66.6672158,3.42505364 L62.4721251,9.42781106 C62.2595106,9.73204124 61.9909313,9.994071 61.6805232,10.2005518 C60.3171315,11.1074682 58.4624854,10.7651457 57.5278749,9.42781106 L53.3327842,3.42505364 C53.2636914,3.32618858 53.1755868,3.24023255 53.0728241,3.17187572 C52.6109648,2.86465084 51.9770946,2.98164781 51.6672158,3.42505364 L47.4721251,9.42781106 C47.2595106,9.73204124 46.9909313,9.994071 46.6805232,10.2005518 C45.3171315,11.1074682 43.4624854,10.7651457 42.5278749,9.42781106 L38.3327842,3.42505364 C38.2636914,3.32618858 38.1755868,3.24023255 38.0728241,3.17187572 C37.6109648,2.86465084 36.9770946,2.98164781 36.6672158,3.42505364 L32.4721251,9.42781106 C32.2595106,9.73204124 31.9909313,9.994071 31.6805232,10.2005518 C30.3171315,11.1074682 28.4624854,10.7651457 27.5278749,9.42781106 L23.3327842,3.42505364 C23.2636914,3.32618858 23.1755868,3.24023255 23.0728241,3.17187572 C22.6109648,2.86465084 21.9770946,2.98164781 21.6672158,3.42505364 L17.4721251,9.42781106 C17.2595106,9.73204124 16.9909313,9.994071 16.6805232,10.2005518 C15.3171315,11.1074682 13.4624854,10.7651457 12.5278749,9.42781106 L8.33278424,3.42505364 C8.26369135,3.32618858 8.1755868,3.24023255 8.07282415,3.17187572 C7.61096475,2.86465084 6.97709462,2.98164781 6.66721576,3.42505364 L3.94757827,7.31658437 C2.0268139,10.0650071 1,13.3125617 1,16.6365363 L1,19" />
        </g>
      </svg>
      <div
        ref="chequeContent"
        class="contents"
      >
        <div class="restaurant">
          {{ cheque.restaurant }}
          <div class="rev-center">
            {{ cheque.revenueCenter }}
          </div>
        </div>
        <div class="divider" />
        <div class="summary">
          <div class="summary-column">
            <div class="open-time">
              <div class="summary-item-label">
                Opened at
              </div>
              <div>{{ openTime }}</div>
            </div>
            <div class="close-time">
              <div class="summary-item-label">
                Closed at
              </div>
              <div>{{ closeTime }}</div>
            </div>
          </div>
          <div class="summary-column right-align">
            <div class="cheque-number">
              <div class="summary-item-label">
                Check no.
              </div>
              <div>{{ cheque.number }}</div>
            </div>
            <div class="server">
              <div class="summary-item-label">
                Server
              </div>
              <div>{{ cheque.server }}</div>
            </div>
          </div>
        </div>
        <div
          v-if="cheque.items.length > 0"
          class="divider"
        />
        <div class="items">
          <div
            v-if="cheque.items.length > 0"
            class="section-title"
          >
            Items ordered
          </div>
          <div
            v-for="(item, idx) in cheque.items"
            :key="idx"
            class="item"
          >
            <div class="order-time">
              {{ formatTime(item.orderTime) }}
            </div>
            <div class="item-name">
              {{ item.item.name }}
            </div>
            <div class="item-spacer" />
            <div class="item-quantity">
              {{ `x${item.quantity}` }}
            </div>
            <div class="item-amount">
              {{ formatAmount(item.amount) }}
            </div>
          </div>
        </div>
        <div class="items">
          <div
            v-if="cheque.items.filter(item => item.isVoid).length > 0"
            class="section-title"
          >
            Voided items
          </div>
          <div
            v-for="(item, idx) in cheque.items.filter(item => item.isVoid)"
            :key="idx"
            class="item"
          >
            <div class="order-time">
              {{ formatTime(item.orderTime) }}
            </div>
            <div class="item-name">
              {{ item.item.name }}
            </div>
            <div class="item-spacer" />
            <div class="item-quantity">
              {{ `x${item.quantity}` }}
            </div>
            <div class="item-amount">
              {{ formatAmount(-item.amount) }}
            </div>
          </div>
        </div>
        <div class="totals">
          <div class="section-title">
            Totals
          </div>
          <div class="subtotals-row">
            subtotal
            <div class="item-spacer" />
            <div class="item-amount">
              {{ formatAmount(cheque.subTotal) }}
            </div>
          </div>
          <div class="subtotals-row">
            discounts
            <div class="item-spacer" />
            <div class="item-amount">
              {{ formatAmount(-cheque.discounts) }}
            </div>
          </div>
          <div class="subtotals-row">
            tax
            <div class="item-spacer" />
            <div class="item-amount">
              {{ formatAmount(cheque.tax) }}
            </div>
          </div>
          <div class="subtotals-row">
            tip
            <div class="item-spacer" />
            <div class="item-amount">
              {{ formatAmount(cheque.tip) }}
            </div>
          </div>
          <div class="subtotals-row">
            total
            <div class="item-spacer" />
            <div class="item-amount">
              {{ formatAmount(cheque.paid) }}
            </div>
          </div>
        </div>
        <div class="divider" />
        <div class="payments">
          <div class="section-title">
            Payments made
          </div>
          <div
            v-for="(payment, idx) in cheque.payments"
            :key="idx"
            class="payment"
          >
            <div class="payment-method-name">
              {{ payment.method.name }}
            </div>
            <div class="payment-spacer" />
            <div class="payment-amount">
              {{ formatAmount(payment.amount) }}
            </div>
          </div>
        </div>
      </div>
      <svg
        viewBox="0 0 375 17"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
      >
        <g
          id="🔩-Components"
          stroke="none"
          stroke-width="1"
          fill="none"
          fill-rule="evenodd"
        >
          <g>
            <path
              id="Path"
              d="M1,1 L1,2.38442932 C1,5.70309201 2.02665754,8.94550095 3.94719244,11.689659 L6.66682993,15.5756154 C6.73584638,15.6742296 6.82389116,15.7600043 6.92662551,15.8282444 C7.38880923,16.1352447 8.02335838,16.0182901 8.33317007,15.5756154 L12.5282607,9.58145642 C12.7409516,9.27755282 13.0095907,9.01584016 13.3200272,8.80963629 C14.6830945,7.90423446 16.5370616,8.24594142 17.4717393,9.58145642 L21.6668299,15.5756154 C21.7358464,15.6742296 21.8238912,15.7600043 21.9266255,15.8282444 C22.3888092,16.1352447 23.0233584,16.0182901 23.3331701,15.5756154 L27.5282607,9.58145642 C27.7409516,9.27755282 28.0095907,9.01584016 28.3200272,8.80963629 C29.6830945,7.90423446 31.5370616,8.24594142 32.4717393,9.58145642 L36.6668299,15.5756154 C36.7358464,15.6742296 36.8238912,15.7600043 36.9266255,15.8282444 C37.3888092,16.1352447 38.0233584,16.0182901 38.3331701,15.5756154 L42.5282607,9.58145642 C42.7409516,9.27755282 43.0095907,9.01584016 43.3200272,8.80963629 C44.6830945,7.90423446 46.5370616,8.24594142 47.4717393,9.58145642 L51.6668299,15.5756154 C51.7358464,15.6742296 51.8238912,15.7600043 51.9266255,15.8282444 C52.3888092,16.1352447 53.0233584,16.0182901 53.3331701,15.5756154 L57.5282607,9.58145642 C57.7409516,9.27755282 58.0095907,9.01584016 58.3200272,8.80963629 C59.6830945,7.90423446 61.5370616,8.24594142 62.4717393,9.58145642 L66.6668299,15.5756154 C66.7358464,15.6742296 66.8238912,15.7600043 66.9266255,15.8282444 C67.3888092,16.1352447 68.0233584,16.0182901 68.3331701,15.5756154 L72.5282607,9.58145642 C72.7409516,9.27755282 73.0095907,9.01584016 73.3200272,8.80963629 C74.6830945,7.90423446 76.5370616,8.24594142 77.4717393,9.58145642 L81.6668299,15.5756154 C81.7358464,15.6742296 81.8238912,15.7600043 81.9266255,15.8282444 C82.3888092,16.1352447 83.0233584,16.0182901 83.3331701,15.5756154 L87.5282607,9.58145642 C87.7409516,9.27755282 88.0095907,9.01584016 88.3200272,8.80963629 C89.6830945,7.90423446 91.5370616,8.24594142 92.4717393,9.58145642 L96.6668299,15.5756154 C96.7358464,15.6742296 96.8238912,15.7600043 96.9266255,15.8282444 C97.3888092,16.1352447 98.0233584,16.0182901 98.3331701,15.5756154 L102.528261,9.58145642 C102.740952,9.27755282 103.009591,9.01584016 103.320027,8.80963629 C104.683095,7.90423446 106.537062,8.24594142 107.471739,9.58145642 L111.66683,15.5756154 C111.735846,15.6742296 111.823891,15.7600043 111.926626,15.8282444 C112.388809,16.1352447 113.023358,16.0182901 113.33317,15.5756154 L117.528261,9.58145642 C117.740952,9.27755282 118.009591,9.01584016 118.320027,8.80963629 C119.683095,7.90423446 121.537062,8.24594142 122.471739,9.58145642 L126.66683,15.5756154 C126.735846,15.6742296 126.823891,15.7600043 126.926626,15.8282444 C127.388809,16.1352447 128.023358,16.0182901 128.33317,15.5756154 L132.528261,9.58145642 C132.740952,9.27755282 133.009591,9.01584016 133.320027,8.80963629 C134.683095,7.90423446 136.537062,8.24594142 137.471739,9.58145642 L141.66683,15.5756154 C141.735846,15.6742296 141.823891,15.7600043 141.926626,15.8282444 C142.388809,16.1352447 143.023358,16.0182901 143.33317,15.5756154 L147.528261,9.58145642 C147.740952,9.27755282 148.009591,9.01584016 148.320027,8.80963629 C149.683095,7.90423446 151.537062,8.24594142 152.471739,9.58145642 L156.66683,15.5756154 C156.735846,15.6742296 156.823891,15.7600043 156.926626,15.8282444 C157.388809,16.1352447 158.023358,16.0182901 158.33317,15.5756154 L162.528261,9.58145642 C162.740952,9.27755282 163.009591,9.01584016 163.320027,8.80963629 C164.683095,7.90423446 166.537062,8.24594142 167.471739,9.58145642 L171.66683,15.5756154 C171.735846,15.6742296 171.823891,15.7600043 171.926626,15.8282444 C172.388809,16.1352447 173.023358,16.0182901 173.33317,15.5756154 L177.528261,9.58145642 C177.740952,9.27755282 178.009591,9.01584016 178.320027,8.80963629 C179.683095,7.90423446 181.537062,8.24594142 182.471739,9.58145642 L186.66683,15.5756154 C186.735846,15.6742296 186.823891,15.7600043 186.926626,15.8282444 C187.388809,16.1352447 188.023358,16.0182901 188.33317,15.5756154 L192.528261,9.58145642 C192.740952,9.27755282 193.009591,9.01584016 193.320027,8.80963629 C194.683095,7.90423446 196.537062,8.24594142 197.471739,9.58145642 L201.66683,15.5756154 C201.735846,15.6742296 201.823891,15.7600043 201.926626,15.8282444 C202.388809,16.1352447 203.023358,16.0182901 203.33317,15.5756154 L207.528261,9.58145642 C207.740952,9.27755282 208.009591,9.01584016 208.320027,8.80963629 C209.683095,7.90423446 211.537062,8.24594142 212.471739,9.58145642 L216.66683,15.5756154 C216.735846,15.6742296 216.823891,15.7600043 216.926626,15.8282444 C217.388809,16.1352447 218.023358,16.0182901 218.33317,15.5756154 L222.528261,9.58145642 C222.740952,9.27755282 223.009591,9.01584016 223.320027,8.80963629 C224.683095,7.90423446 226.537062,8.24594142 227.471739,9.58145642 L231.66683,15.5756154 C231.735846,15.6742296 231.823891,15.7600043 231.926626,15.8282444 C232.388809,16.1352447 233.023358,16.0182901 233.33317,15.5756154 L237.528261,9.58145642 C237.740952,9.27755282 238.009591,9.01584016 238.320027,8.80963629 C239.683095,7.90423446 241.537062,8.24594142 242.471739,9.58145642 L246.66683,15.5756154 C246.735846,15.6742296 246.823891,15.7600043 246.926626,15.8282444 C247.388809,16.1352447 248.023358,16.0182901 248.33317,15.5756154 L252.528261,9.58145642 C252.740952,9.27755282 253.009591,9.01584016 253.320027,8.80963629 C254.683095,7.90423446 256.537062,8.24594142 257.471739,9.58145642 L261.66683,15.5756154 C261.735846,15.6742296 261.823891,15.7600043 261.926626,15.8282444 C262.388809,16.1352447 263.023358,16.0182901 263.33317,15.5756154 L267.528261,9.58145642 C267.740952,9.27755282 268.009591,9.01584016 268.320027,8.80963629 C269.683095,7.90423446 271.537062,8.24594142 272.471739,9.58145642 L276.66683,15.5756154 C276.735846,15.6742296 276.823891,15.7600043 276.926626,15.8282444 C277.388809,16.1352447 278.023358,16.0182901 278.33317,15.5756154 L282.528261,9.58145642 C282.740952,9.27755282 283.009591,9.01584016 283.320027,8.80963629 C284.683095,7.90423446 286.537062,8.24594142 287.471739,9.58145642 L291.66683,15.5756154 C291.735846,15.6742296 291.823891,15.7600043 291.926626,15.8282444 C292.388809,16.1352447 293.023358,16.0182901 293.33317,15.5756154 L297.528261,9.58145642 C297.740952,9.27755282 298.009591,9.01584016 298.320027,8.80963629 C299.683095,7.90423446 301.537062,8.24594142 302.471739,9.58145642 L306.66683,15.5756154 C306.735846,15.6742296 306.823891,15.7600043 306.926626,15.8282444 C307.388809,16.1352447 308.023358,16.0182901 308.33317,15.5756154 L312.528261,9.58145642 C312.740952,9.27755282 313.009591,9.01584016 313.320027,8.80963629 C314.683095,7.90423446 316.537062,8.24594142 317.471739,9.58145642 L321.66683,15.5756154 C321.735846,15.6742296 321.823891,15.7600043 321.926626,15.8282444 C322.388809,16.1352447 323.023358,16.0182901 323.33317,15.5756154 L327.528261,9.58145642 C327.740952,9.27755282 328.009591,9.01584016 328.320027,8.80963629 C329.683095,7.90423446 331.537062,8.24594142 332.471739,9.58145642 L336.66683,15.5756154 C336.735846,15.6742296 336.823891,15.7600043 336.926626,15.8282444 C337.388809,16.1352447 338.023358,16.0182901 338.33317,15.5756154 L342.528261,9.58145642 C342.740952,9.27755282 343.009591,9.01584016 343.320027,8.80963629 C344.683095,7.90423446 346.537062,8.24594142 347.471739,9.58145642 L351.66683,15.5756154 C351.735846,15.6742296 351.823891,15.7600043 351.926626,15.8282444 C352.388809,16.1352447 353.023358,16.0182901 353.33317,15.5756154 L357.528261,9.58145642 C357.740952,9.27755282 358.009591,9.01584016 358.320027,8.80963629 C359.683095,7.90423446 361.537062,8.24594142 362.471739,9.58145642 L366.66683,15.5756154 C366.735846,15.6742296 366.823891,15.7600043 366.926626,15.8282444 C367.388809,16.1352447 368.023358,16.0182901 368.33317,15.5756154 L371.052808,11.689659 C372.973342,8.94550095 374,5.70309201 374,2.38442932 L374,1"
            />
          </g>
        </g>
      </svg>
    </div>
  </div>
</template>

<script>

import BusyOverlay from '@/components/common/BusyOverlay'
import { formatDate, formatTime } from '@/utils/dateTimeUtils'
import { formatAmount } from '@/utils/moneyUtils'
import html2canvas from 'html2canvas'
import jsPDF from 'jspdf'

export default {
  name: 'CustomerCheque',
  components: {
    BusyOverlay,
  },
  props: {
    cheque: { type: Object, required: true, },
  },
  data () {
    return {
      saving: false,
    }
  },
	computed: {
    openTime () {
      return formatDate(this.cheque.openTime)
    },
    closeTime () {
      return formatDate(this.cheque.closeTime)
    },
  },
  methods: {
    formatAmount,
    formatTime,
    async print () {
      if (this.saving) {
        return
      }
      this.saving = true
      const filename  = `check_${this.$route.params.cheque_id}.pdf`
      let clientRect = this.$refs.chequeContent.getBoundingClientRect()
      let canvas = await html2canvas(this.$refs.chequeContent, { scale: 2, })
      let pdf = new jsPDF('p', 'px', [canvas.width, canvas.height,])
      pdf.addImage(canvas.toDataURL('image/png'),
        'PNG',
        0,
        0,
        clientRect.width,
        clientRect.height)
      pdf.save(filename)
      this.saving = false
    },
  },
}

</script>

<style lang="scss" scoped>

.customer-cheque {
	display: flex;
	flex-direction: column;
  background: $darkGreen;
  color: $darkGreen;
  overflow: auto;
}
path {
  fill: #FFFBF6;
  stroke: $stone;
  stroke-width: 2;
  fill: #FFFBF6;
}
svg {
  width: 100%;
  height: auto;
}
.contents {
	padding: 24px;
  width: 100%;
  background: #FFFBF6;
  margin-top: -2px;
  margin-left: 0.5px;
  margin-right: 0.5px;
  margin-bottom: -2px;
  border-left: 1.5px solid $stone;
  border-right: 1.5px solid $stone;
}
.divider {
  margin: 8px 0;
	height: 0px;
	border-bottom: 1px solid $darkGreen;
}
.cheque {
  position: relative;
	display: flex;
	flex-direction: column;
	align-items: center;
}
.section-title {
  color: rgba($darkGreen, .75);
  text-align: center;
  font-size: 18px;
  padding: 8px 16px;
}
.restaurant {
	margin: 24px;
  font-size: 24px;
}
.server, .open-time, .close-time, .cheque-number {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  margin: 16px;
}
.server, .restaurant {
  text-transform: capitalize;
}
.item, .payment {
  display: flex;
}
.item-spacer, .payment-spacer {
  flex-grow: 1;
  border-bottom: 1px dashed $darkGreen;
  margin: 8px 4px;
}
.item-amount, .payment-amount {
  padding-left: 24px;
  min-width: 88px;
  text-align: right;
}
.buttons {
  justify-content: flex-end;
  display: flex;
}
.save {
  position: relative;
}
.summary {
  display: flex;
  justify-content: space-between;
}
.summary-column {
  display: flex;
  flex-direction: column;
}
.right-align {
  text-align: right;
}
.summary-item-label, .rev-center {
  color: rgba($darkGreen, .75);
}
.rev-center {
  font-size: 16px;
}
.order-time {
  width: 64px;
  margin-right: 16px;
  white-space: nowrap;
}
.subtotals-row {
  margin-left: 128px;
  display: flex;
}
</style>

